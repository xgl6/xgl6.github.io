{"posts":[{"title":"Shiroå®‰å…¨æ¡†æ¶","content":"Shiroå®‰å…¨æ¡†æ¶ 0. å‰è¨€ 0.1 å¸¸è§é—®é¢˜ ä¼ ç»Ÿwebé¡¹ç›®å¦‚ä½•è¿›è¡Œè¯·æ±‚çš„åˆæ³•æ€§éªŒè¯,? Tokenå’ŒSessionç›¸æ¯”çœŸæ­£çš„ä¼˜åŠ¿åœ¨å“ªé‡Œ,? ä½¿ç”¨Tokençš„æ­£ç¡®å§¿åŠ¿æ˜¯ä»€ä¹ˆ,? 0.2 å…·ä½“ä¸šåŠ¡åœºæ™¯ 0.2.1 ä¼ ç»ŸWebå­˜åœ¨çš„é—®é¢˜ å¼€å‘äººå‘˜åœ¨ç¼–å†™ä»£ç è¿‡ç¨‹ä¸­ä¸€ç‚¹éƒ½æ²¡æœ‰åšè¯·æ±‚çš„æ ¡éªŒ,å®‰å…¨æ€§ä¸º0 å¼€å‘äººå‘˜ç»Ÿä¸€ä½¿ç”¨Sessionè¿›è¡Œè¯·æ±‚çš„åˆ¤æ–­,å³åœ¨ç™»å½•è®¤è¯æˆåŠŸå,å°†ç”¨æˆ·ä¿¡æ¯å­˜å‚¨åœ¨Sessionä¸­,å‡¡æ˜¯æ¶‰åŠåˆ°æ ¡éªŒæƒé™çš„è¯·æ±‚,åœ¨ç›¸å…³ä»£ç é‡Œ,éƒ½è¦ä»å½“å‰Sessionä¸­æå–ä¿¡æ¯. æœåŠ¡ç«¯ä½¿ç”¨Sessionçš„å¼Šç«¯ä»¥åŠä¸ºä½•è¦ä½¿ç”¨tokençš„æ–‡ç«  , è¯·çœ‹è¿™é‡Œ 0.2.2 ç®€å•æ€»ç»“ é¦–å…ˆSessionå¦‚æœå­˜å‚¨åœ¨æœåŠ¡å™¨å†…å­˜ä¸­,å¦‚æœSessionè¿‡å¤šï¼ŒåŠ¿å¿…ä¼šå½±å“æœåŠ¡å™¨æ€§èƒ½ã€‚ Sessionå¦‚æœå­˜å‚¨åœ¨æœåŠ¡å™¨å†…å­˜ä¸­ï¼Œåœ¨å¤§å‹åˆ†å¸ƒå¼ä¸­(æœåŠ¡å™¨å¾ˆå¤šå°çš„æƒ…å†µä¸‹)å¾ˆéš¾åšåˆ°å¤šä¸ªæœåŠ¡å™¨ä¹‹é—´Sessionå…±äº« Sessionå’Œå¯¹åº”çš„SessionIdå¯ä»¥å­˜å‚¨åœ¨æ•°æ®åº“ä¸­(ä¸è¦è¢«ç½‘ä¸Šæœ‰äº›æ–‡ç« è¯¯å¯¼äº†ï¼Œè¯´ä»€ä¹ˆåªèƒ½å­˜åœ¨å†…å­˜ä¸­)ï¼Œè™½ç„¶ç»å¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚å®¢æˆ·ç«¯æ‹¿ç€SessionIdå»æœåŠ¡å™¨å†…å­˜æˆ–è€…æ•°æ®åº“ä¸­æŸ¥æ‰¾å¯¹åº”çš„Session tokenä¸€èˆ¬æ”¾åœ¨è¯·æ±‚å¤´ä¸­ï¼Œåœ¨å‰åç«¯åˆ†ç¦»çš„æ—¶ä»£ï¼ŒæœåŠ¡å™¨è®¤è¯é€šè¿‡ä¹‹åï¼Œä¼šè¿”å›ç»™å®¢æˆ·ç«¯ä¸€ä¸ªtoken tokenå’ŒSessionä¸€æ ·ï¼Œéƒ½å¯ä»¥å­˜å‚¨åœ¨æ•°æ®åº“ï¼Œéƒ½è®¾ç½®æœ‰è¿‡æœŸæ—¶é—´ åœ¨ç§»åŠ¨ç«¯ï¼Œtokençš„åº”ç”¨ä»·å€¼æ›´é«˜ï¼Œå› ä¸ºç§»åŠ¨ç«¯ä¸æ”¯æŒCookie æœåŠ¡å™¨å¦‚ä½•æ ¡éªŒè¯·æ±‚ä¸­çš„tokenæ˜¯å¦ä¸ºç™»å½•è®¤è¯çš„æ—¶è¿”å›ç»™å®¢æˆ·ç«¯çš„token,? å°†tokenå€¼å’Œåˆ›å»ºæ—¶é—´å’Œè¿‡æœŸæ—¶é—´ä¿å­˜åœ¨æ•°æ®åº“ï¼Œæ¯ä¸€æ¬¡è¯·æ±‚æ ¹æ®tokenå»æ•°æ®åº“é‡Œè¿›è¡ŒæŸ¥è¯¢æ¯”å¯¹ï¼Œæ¥åˆ¤æ–­æ˜¯å¦åˆæ³•ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼å’Œå°†Sessionå­˜å‚¨åœ¨æ•°æ®åº“é‡Œæ²¡å•¥åŒºåˆ«å•Šï¼Œæ¯æ¬¡è¯·æ±‚éƒ½è¦è¿›è¡Œæ•°æ®åº“çš„æŸ¥è¯¢æ“ä½œï¼Œå½“è¯·æ±‚å¾ˆå¤šæ—¶ï¼Œæ•°æ®åº“å‹åŠ›ä¹Ÿå¾ˆå¤§ï¼ŒåŒæ—¶è¿˜è¦å®šæœŸåˆ é™¤è¿‡æœŸçš„token å°†tokenå€¼å’Œåˆ›å»ºæ—¶é—´å’Œè¿‡æœŸæ—¶é—´ä¿å­˜redisä¸­ï¼Œè¿™æ ·å¯ä»¥ä¿è¯è¯·æ±‚å¤šçš„æ—¶å€™ï¼Œredisæ•°æ®åº“å¯ä»¥å¾ˆå¥½çš„æ‰›ä½å‹åŠ›ï¼ŒåŒæ—¶redisä¹Ÿæä¾›äº†keyçš„è¿‡æœŸæ—¶é—´ï¼Œè§£å†³äº†1ä¸­çš„ä¸¤ä¸ªé—®é¢˜ï¼Œä½†æ˜¯åŒæ ·çš„è§£å†³æ–¹å¼ä¹Ÿå¯ä»¥ç”¨åœ¨Sessionä¸Šå•Šï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜è¦ç”¨ä½ å•Šï¼Ÿ(Sessionä¹Ÿä¸æ˜¯æ²¡æœ‰åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆçš„ï¼Œæ€»ä¸èƒ½ä¸ºäº†ç”¨tokenè€Œç”¨tokeå§ï¼Œä»–çš„å‰å®³ä¹‹å¤„åœ¨å“ª) ä¸å­˜å‚¨tokenï¼Œæ— è®ºåœ¨ç¼“å­˜ä¸­æˆ–è€…æ•°æ®åº“ä¸­ã€‚toeknå’Œsessionç›¸æ¯”ï¼Œæœ€é‡è¦çš„ä¼˜åŠ¿åº”è¯¥åœ¨äºå‡å°‘æœåŠ¡å™¨çš„å‹åŠ›ï¼Œä¸è®ºæ˜¯å†…å­˜å‹åŠ›è¿˜æ˜¯æ•°æ®åº“çš„å‹åŠ›ã€‚æ€è·¯å¤§è‡´å¦‚ä¸‹ï¼šç”¨æˆ·ç™»å½•è®¤è¯é€šè¿‡ä¹‹å----&gt;è¿”å›ç»™å®¢æˆ·ç«¯çš„tokenåº”è¯¥æ˜¯åŠ å¯†äº†çš„tokenï¼Œè¿™ä¸ªåŠ å¯†ç®—æ³•æ˜¯å…³é”®ï¼Œå¤§è‡´æ€è·¯æ˜¯è¿™æ ·çš„ï¼šè¦å°†ç”¨æˆ·çš„éƒ¨åˆ†ä¿¡æ¯å’Œè¯·æ±‚çš„URLï¼Œæ—¶é—´æˆ³èåˆåœ¨ä¸€èµ·ï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ã€‚ä¸‹æ¬¡å®¢æˆ·ç«¯è¯·æ±‚æ—¶ï¼Œä¼šæ ¹æ®URLï¼Œæ—¶é—´æˆ³ï¼Œå’Œéƒ¨åˆ†ç”¨æˆ·ä¿¡æ¯é‡æ–°ç”Ÿæˆä¸€ä¸ªtokenï¼Œå°†è¿™ä¸ªtokenå’Œå®¢æˆ·ç«¯è¯·æ±‚ä¸­å¸¦çš„tokenæ¯”è¾ƒï¼Œå¦‚æœç›¸åŒåˆ™è¿™æ¬¡è¯·æ±‚åˆæ³•ã€‚è¿™æ ·tokenä¸ç”¨å ç”¨å­˜å‚¨ç©ºé—´ï¼Œè€Œä¸”åŠ è§£å¯†çš„è¿‡ç¨‹è¦æ¯”æ•°æ®åº“æŸ¥è¯¢å¿«å¾—å¤šã€‚å…·ä½“ä¹Ÿå¯ä»¥å‚è€ƒ è¿™ç¯‡æ–‡ç«  1. ä»€ä¹ˆæ˜¯Shiro 1.1 ä»€ä¹ˆæ˜¯Shiro Apache Shiroæ˜¯ä¸€ä¸ªå¼ºå¤§ä¸”æ˜“ç”¨çš„Javaå®‰å…¨æ¡†æ¶,æ‰§è¡Œèº«ä»½éªŒè¯ã€æˆæƒã€å¯†ç å’Œä¼šè¯ç®¡ç†ã€‚ä½¿ç”¨Shiroçš„æ˜“äºç†è§£çš„API,æ‚¨å¯ä»¥å¿«é€Ÿã€è½»æ¾åœ°è·å¾—ä»»ä½•åº”ç”¨ç¨‹åº,ä»æœ€å°çš„ç§»åŠ¨åº”ç”¨ç¨‹åºåˆ°æœ€å¤§çš„ç½‘ç»œå’Œä¼ä¸šåº”ç”¨ç¨‹åº. Apache Shiro çš„é¦–è¦ç›®æ ‡æ˜¯æ˜“äºä½¿ç”¨å’Œç†è§£ã€‚å®‰å…¨æœ‰æ—¶å€™æ˜¯å¾ˆå¤æ‚çš„ï¼Œç”šè‡³æ˜¯ç—›è‹¦çš„ï¼Œä½†å®ƒæ²¡æœ‰å¿…è¦è¿™æ ·ã€‚æ¡†æ¶åº”è¯¥å°½å¯èƒ½æ©ç›–å¤æ‚çš„åœ°æ–¹ï¼Œéœ²å‡ºä¸€ä¸ªå¹²å‡€è€Œç›´è§‚çš„ APIï¼Œæ¥ç®€åŒ–å¼€å‘äººå‘˜åœ¨ä½¿ä»–ä»¬çš„åº”ç”¨ç¨‹åºå®‰å…¨ä¸Šçš„åŠªåŠ›ã€‚ä»¥ä¸‹æ˜¯ä½ å¯ä»¥ç”¨ Apache Shiro æ‰€åšçš„äº‹æƒ…ï¼š éªŒè¯ç”¨æˆ·æ¥æ ¸å®ä»–ä»¬çš„èº«ä»½ å¯¹ç”¨æˆ·æ‰§è¡Œè®¿é—®æ§åˆ¶ï¼Œå¦‚ï¼š åˆ¤æ–­ç”¨æˆ·æ˜¯å¦è¢«åˆ†é…äº†ä¸€ä¸ªç¡®å®šçš„å®‰å…¨è§’è‰² åˆ¤æ–­ç”¨æˆ·æ˜¯å¦è¢«å…è®¸åšæŸäº‹ åœ¨ä»»ä½•ç¯å¢ƒä¸‹ä½¿ç”¨ Session APIï¼Œå³ä½¿æ²¡æœ‰ Web æˆ– EJB å®¹å™¨ã€‚ åœ¨èº«ä»½éªŒè¯ï¼Œè®¿é—®æ§åˆ¶æœŸé—´æˆ–åœ¨ä¼šè¯çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¯¹äº‹ä»¶ä½œå‡ºååº”ã€‚ èšé›†ä¸€ä¸ªæˆ–å¤šä¸ªç”¨æˆ·å®‰å…¨æ•°æ®çš„æ•°æ®æºï¼Œå¹¶ä½œä¸ºä¸€ä¸ªå•ä¸€çš„å¤åˆç”¨æˆ·â€œè§†å›¾â€ã€‚ å¯ç”¨å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰åŠŸèƒ½ã€‚ ä¸ºæ²¡æœ‰å…³è”åˆ°ç™»å½•çš„ç”¨æˆ·å¯ç”¨&quot;Remember Me&quot;æœåŠ¡ 1.2 ä¸Spring Securityçš„å¯¹æ¯” shiro : Shiroè¾ƒä¹‹ Spring Securityï¼ŒShiroåœ¨ä¿æŒå¼ºå¤§åŠŸèƒ½çš„åŒæ—¶ï¼Œè¿˜åœ¨ç®€å•æ€§å’Œçµæ´»æ€§æ–¹é¢æ‹¥æœ‰å·¨å¤§ä¼˜åŠ¿ã€‚ æ˜“äºç†è§£çš„ Java Security APIï¼› ç®€å•çš„èº«ä»½è®¤è¯ï¼ˆç™»å½•ï¼‰ï¼Œæ”¯æŒå¤šç§æ•°æ®æºï¼ˆLDAPï¼ŒJDBCï¼ŒKerberosï¼ŒActiveDirectory ç­‰ï¼‰ï¼› å¯¹è§’è‰²çš„ç®€å•çš„ç­¾æƒï¼ˆè®¿é—®æ§åˆ¶ï¼‰ï¼Œæ”¯æŒç»†ç²’åº¦çš„ç­¾æƒï¼› æ”¯æŒä¸€çº§ç¼“å­˜ï¼Œä»¥æå‡åº”ç”¨ç¨‹åºçš„æ€§èƒ½ï¼› å†…ç½®çš„åŸºäº POJO ä¼ä¸šä¼šè¯ç®¡ç†ï¼Œé€‚ç”¨äº Web ä»¥åŠé Web çš„ç¯å¢ƒï¼› å¼‚æ„å®¢æˆ·ç«¯ä¼šè¯è®¿é—®ï¼› éå¸¸ç®€å•çš„åŠ å¯† APIï¼› ä¸è·Ÿä»»ä½•çš„æ¡†æ¶æˆ–è€…å®¹å™¨æ†ç»‘ï¼Œå¯ä»¥ç‹¬ç«‹è¿è¡Œ Spring Securityï¼š é™¤äº†ä¸èƒ½è„±ç¦»Springï¼Œshiroçš„åŠŸèƒ½å®ƒéƒ½æœ‰ã€‚è€Œä¸”Spring Securityå¯¹Oauthã€OpenIDä¹Ÿæœ‰æ”¯æŒ,Shiroåˆ™éœ€è¦è‡ªå·±æ‰‹åŠ¨å®ç°ã€‚Spring Securityçš„æƒé™ç»†ç²’åº¦æ›´é«˜ã€‚ ç‚¹æˆ‘äº†è§£ 1.3 Shiroçš„åŠŸèƒ½æ¨¡å— Shiroå¯ä»¥éå¸¸å®¹æ˜“çš„å¼€å‘å‡ºè¶³å¤Ÿå¥½çš„åº”ç”¨ï¼Œå…¶ä¸ä»…å¯ä»¥ç”¨åœ¨JavaSEç¯å¢ƒï¼Œä¹Ÿå¯ä»¥ç”¨åœ¨JavaEEç¯å¢ƒã€‚Shiroå¯ä»¥å¸®åŠ©æˆ‘ä»¬å®Œæˆï¼šè®¤è¯ã€æˆæƒã€åŠ å¯†ã€ä¼šè¯ç®¡ç†ã€ä¸Webé›†æˆã€ç¼“å­˜ç­‰ã€‚è¿™ä¸å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„å˜›ï¼Œè€Œä¸”Shiroçš„APIä¹Ÿæ˜¯éå¸¸ç®€å•ï¼›å…¶åŸºæœ¬åŠŸèƒ½ç‚¹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š Authenticationï¼šèº«ä»½è®¤è¯/ç™»å½•ï¼ŒéªŒè¯ç”¨æˆ·æ˜¯ä¸æ˜¯æ‹¥æœ‰ç›¸åº”çš„èº«ä»½ã€‚ Authorizationï¼šæˆæƒï¼Œå³æƒé™éªŒè¯ï¼ŒéªŒè¯æŸä¸ªå·²è®¤è¯çš„ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰æŸä¸ªæƒé™ï¼›å³åˆ¤æ–­ç”¨æˆ·æ˜¯å¦èƒ½åšäº‹æƒ…ã€‚ Session Managementï¼šä¼šè¯ç®¡ç†ï¼Œå³ç”¨æˆ·ç™»å½•åå°±æ˜¯ä¸€æ¬¡ä¼šè¯ï¼Œåœ¨æ²¡æœ‰é€€å‡ºä¹‹å‰ï¼Œå®ƒçš„æ‰€æœ‰ä¿¡æ¯éƒ½åœ¨ä¼šè¯ä¸­ï¼›ä¼šè¯å¯ä»¥æ˜¯æ™®é€šJavaSEç¯å¢ƒçš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å¦‚Webç¯å¢ƒçš„ã€‚ Cryptographyï¼šåŠ å¯†ï¼Œä¿æŠ¤æ•°æ®çš„å®‰å…¨æ€§ï¼Œå¦‚å¯†ç åŠ å¯†å­˜å‚¨åˆ°æ•°æ®åº“ï¼Œè€Œä¸æ˜¯æ˜æ–‡å­˜å‚¨ã€‚ Web Supportï¼šShiro çš„ web æ”¯æŒçš„ API èƒ½å¤Ÿè½»æ¾åœ°å¸®åŠ©ä¿æŠ¤ Web åº”ç”¨ç¨‹åºã€‚ Cachingï¼šç¼“å­˜ï¼Œæ¯”å¦‚ç”¨æˆ·ç™»å½•åï¼Œå…¶ç”¨æˆ·ä¿¡æ¯ã€æ‹¥æœ‰çš„è§’è‰²/æƒé™ä¸å¿…æ¯æ¬¡å»æŸ¥ï¼Œè¿™æ ·å¯ä»¥æé«˜æ•ˆç‡ã€‚ Concurrencyï¼šApache Shiro åˆ©ç”¨å®ƒçš„å¹¶å‘ç‰¹æ€§æ¥æ”¯æŒå¤šçº¿ç¨‹åº”ç”¨ç¨‹åºã€‚ Testingï¼šæµ‹è¯•æ”¯æŒçš„å­˜åœ¨æ¥å¸®åŠ©ä½ ç¼–å†™å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•ï¼Œå¹¶ç¡®ä¿ä½ çš„èƒ½å¤Ÿå¦‚é¢„æœŸçš„ä¸€æ ·å®‰å…¨ã€‚ &quot;Run As&quot;ï¼šä¸€ä¸ªå…è®¸ç”¨æˆ·å‡è®¾ä¸ºå¦ä¸€ä¸ªç”¨æˆ·èº«ä»½ï¼ˆå¦‚æœå…è®¸ï¼‰çš„åŠŸèƒ½ï¼Œæœ‰æ—¶å€™åœ¨ç®¡ç†è„šæœ¬å¾ˆæœ‰ç”¨ã€‚ &quot;Remember Me&quot;ï¼šè®°ä½æˆ‘ã€‚ 2. Shiroçš„å†…éƒ¨ç»“æ„ Subjectï¼šä¸»ä½“ï¼Œå¯ä»¥çœ‹åˆ°ä¸»ä½“å¯ä»¥æ˜¯ä»»ä½•å¯ä»¥ä¸åº”ç”¨äº¤äº’çš„â€œç”¨æˆ·â€ï¼› SecurityManagerï¼šç›¸å½“äºSpringMVCä¸­çš„DispatcherServletæˆ–è€…Struts2ä¸­çš„FilterDispatcherï¼›æ˜¯Shiroçš„å¿ƒè„ï¼›æ‰€æœ‰å…·ä½“çš„äº¤äº’éƒ½é€šè¿‡SecurityManagerè¿›è¡Œæ§åˆ¶ï¼›å®ƒç®¡ç†ç€æ‰€æœ‰Subjectã€ä¸”è´Ÿè´£è¿›è¡Œè®¤è¯å’Œæˆæƒã€åŠä¼šè¯ã€ç¼“å­˜çš„ç®¡ç†ã€‚ Authenticatorï¼šè®¤è¯å™¨ï¼Œè´Ÿè´£ä¸»ä½“è®¤è¯çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªæ‰©å±•ç‚¹ï¼Œå¦‚æœç”¨æˆ·è§‰å¾—Shiroé»˜è®¤çš„ä¸å¥½ï¼Œå¯ä»¥è‡ªå®šä¹‰å®ç°ï¼›å…¶éœ€è¦è®¤è¯ç­–ç•¥ï¼ˆAuthentication Strategyï¼‰ï¼Œå³ä»€ä¹ˆæƒ…å†µä¸‹ç®—ç”¨æˆ·è®¤è¯é€šè¿‡äº†ï¼› Authrizerï¼šæˆæƒå™¨ï¼Œæˆ–è€…è®¿é—®æ§åˆ¶å™¨ï¼Œç”¨æ¥å†³å®šä¸»ä½“æ˜¯å¦æœ‰æƒé™è¿›è¡Œç›¸åº”çš„æ“ä½œï¼›å³æ§åˆ¶ç€ç”¨æˆ·èƒ½è®¿é—®åº”ç”¨ä¸­çš„å“ªäº›åŠŸèƒ½ï¼› Realmï¼šå¯ä»¥æœ‰1ä¸ªæˆ–å¤šä¸ªRealmï¼Œå¯ä»¥è®¤ä¸ºæ˜¯å®‰å…¨å®ä½“æ•°æ®æºï¼Œå³ç”¨äºè·å–å®‰å…¨å®ä½“çš„ï¼›å¯ä»¥æ˜¯JDBCå®ç°ï¼Œä¹Ÿå¯ä»¥æ˜¯LDAPå®ç°ï¼Œæˆ–è€…å†…å­˜å®ç°ç­‰ç­‰ï¼›ç”±ç”¨æˆ·æä¾›ï¼›æ³¨æ„ï¼šShiroä¸çŸ¥é“ä½ çš„ç”¨æˆ·/æƒé™å­˜å‚¨åœ¨å“ªåŠä»¥ä½•ç§æ ¼å¼å­˜å‚¨ï¼›æ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬åœ¨åº”ç”¨ä¸­éƒ½éœ€è¦å®ç°è‡ªå·±çš„Realmï¼› SessionManagerï¼šå¦‚æœå†™è¿‡Servletå°±åº”è¯¥çŸ¥é“Sessionçš„æ¦‚å¿µï¼ŒSessionå‘¢éœ€è¦æœ‰äººå»ç®¡ç†å®ƒçš„ç”Ÿå‘½å‘¨æœŸï¼Œè¿™ä¸ªç»„ä»¶å°±æ˜¯SessionManagerï¼›è€ŒShiroå¹¶ä¸ä»…ä»…å¯ä»¥ç”¨åœ¨Webç¯å¢ƒï¼Œä¹Ÿå¯ä»¥ç”¨åœ¨å¦‚æ™®é€šçš„JavaSEç¯å¢ƒã€EJBç­‰ç¯å¢ƒï¼›æ‰€ä»¥ï¼ŒShiroå°±æŠ½è±¡äº†ä¸€ä¸ªè‡ªå·±çš„Sessionæ¥ç®¡ç†ä¸»ä½“ä¸åº”ç”¨ä¹‹é—´äº¤äº’çš„æ•°æ®ï¼› SessionDAOï¼šDAOå¤§å®¶éƒ½ç”¨è¿‡ï¼Œæ•°æ®è®¿é—®å¯¹è±¡ï¼Œç”¨äºä¼šè¯çš„CRUDï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³æŠŠSessionä¿å­˜åˆ°æ•°æ®åº“ï¼Œé‚£ä¹ˆå¯ä»¥å®ç°è‡ªå·±çš„SessionDAOï¼Œé€šè¿‡å¦‚JDBCå†™åˆ°æ•°æ®åº“ï¼›æ¯”å¦‚æƒ³æŠŠSessionæ”¾åˆ°Memcachedä¸­ï¼Œå¯ä»¥å®ç°è‡ªå·±çš„Memcached SessionDAOï¼›å¦å¤–SessionDAOä¸­å¯ä»¥ä½¿ç”¨Cacheè¿›è¡Œç¼“å­˜ï¼Œä»¥æé«˜æ€§èƒ½ï¼› CacheManagerï¼šç¼“å­˜æ§åˆ¶å™¨ï¼Œæ¥ç®¡ç†å¦‚ç”¨æˆ·ã€è§’è‰²ã€æƒé™ç­‰çš„ç¼“å­˜çš„ï¼›å› ä¸ºè¿™äº›æ•°æ®åŸºæœ¬ä¸Šå¾ˆå°‘å»æ”¹å˜ï¼Œæ”¾åˆ°ç¼“å­˜ä¸­åå¯ä»¥æé«˜è®¿é—®çš„æ€§èƒ½ Cryptographyï¼šå¯†ç æ¨¡å—ï¼ŒShiroæé«˜äº†ä¸€äº›å¸¸è§çš„åŠ å¯†ç»„ä»¶ç”¨äºå¦‚å¯†ç åŠ å¯†/è§£å¯†çš„ã€‚ 3. åº”ç”¨ç¨‹åºä½¿ç”¨Shiro ä¹Ÿå°±æ˜¯è¯´å¯¹äºæˆ‘ä»¬è€Œè¨€ï¼Œæœ€ç®€å•çš„ä¸€ä¸ªShiroåº”ç”¨ï¼š åº”ç”¨ä»£ç é€šè¿‡Subjectæ¥è¿›è¡Œè®¤è¯å’Œæˆæƒï¼Œè€ŒSubjectåˆå§”æ‰˜ç»™SecurityManagerï¼› æˆ‘ä»¬éœ€è¦ç»™Shiroçš„SecurityManageræ³¨å…¥Realmï¼Œä»è€Œè®©SecurityManagerèƒ½å¾—åˆ°åˆæ³•çš„ç”¨æˆ·åŠå…¶æƒé™è¿›è¡Œåˆ¤æ–­ã€‚ ä»ä»¥ä¸Šä¹Ÿå¯ä»¥çœ‹å‡ºï¼ŒShiroä¸æä¾›ç»´æŠ¤ç”¨æˆ·/æƒé™ï¼Œè€Œæ˜¯é€šè¿‡Realmè®©å¼€å‘äººå‘˜è‡ªå·±æ³¨å…¥ã€‚ 4. Shiroçš„å…¥é—¨ 4.1 æ­å»ºåŸºäºiniçš„è¿è¡Œç¯å¢ƒ åˆ›å»ºå·¥ç¨‹å¯¼å…¥shiroåæ ‡ &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.shiro&lt;/groupId&gt; &lt;artifactId&gt;shiro-core&lt;/artifactId&gt; &lt;version&gt;1.3.2&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;4.12&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;commons-logging&lt;/groupId&gt; &lt;artifactId&gt;commons-logging&lt;/artifactId&gt; &lt;version&gt;1.1.3&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; 4.2 ç”¨æˆ·è®¤è¯ è®¤è¯ï¼šèº«ä»½è®¤è¯/ç™»å½•ï¼ŒéªŒè¯ç”¨æˆ·æ˜¯ä¸æ˜¯æ‹¥æœ‰ç›¸åº”çš„èº«ä»½ã€‚åŸºäºshiroçš„è®¤è¯ï¼Œæ˜¯é€šè¿‡subjectçš„loginæ–¹æ³•å®Œæˆç”¨æˆ·è®¤è¯å·¥ä½œçš„ åœ¨resourceç›®å½•ä¸‹åˆ›å»ºshiroçš„inié…ç½®æ–‡ä»¶æ„é€ æ¨¡æ‹Ÿæ•°æ®ï¼ˆshiro-auth.iniï¼‰ [users] #æ¨¡æ‹Ÿä»æ•°æ®åº“æŸ¥è¯¢çš„ç”¨æˆ· #æ•°æ®æ ¼å¼ ç”¨æˆ·å=å¯†ç  lxy=123456789 xgl=987654321 æµ‹è¯•ç”¨æˆ·è®¤è¯ @Test public void testLogin() throws Exception{ //1.åŠ è½½inié…ç½®æ–‡ä»¶åˆ›å»ºSecurityManager Factory&lt;SecurityManager&gt; factory = new IniSecurityManagerFactory(&quot;classpath:shiro.ini&quot;); //2.è·å–securityManager SecurityManager securityManager = factory.getInstance(); //3.å°†securityManagerç»‘å®šåˆ°å½“å‰è¿è¡Œç¯å¢ƒ SecurityUtils.setSecurityManager(securityManager); //4.åˆ›å»ºä¸»ä½“(æ­¤æ—¶çš„ä¸»ä½“è¿˜ä¸ºç»è¿‡è®¤è¯) Subject subject = SecurityUtils.getSubject(); /** * æ¨¡æ‹Ÿç™»å½•ï¼Œå’Œä¼ ç»Ÿç­‰ä¸åŒçš„æ˜¯éœ€è¦ä½¿ç”¨ä¸»ä½“è¿›è¡Œç™»å½• */ //5.æ„é€ ä¸»ä½“ç™»å½•çš„å‡­è¯ï¼ˆå³ç”¨æˆ·å/å¯†ç ï¼‰ //ç¬¬ä¸€ä¸ªå‚æ•°ï¼šç™»å½•ç”¨æˆ·åï¼Œç¬¬äºŒä¸ªå‚æ•°ï¼šç™»å½•å¯†ç  UsernamePasswordToken upToken = new UsernamePasswordToken(&quot;lxy&quot;,&quot;123456789&quot;); //6.ä¸»ä½“ç™»å½• subject.login(upToken); //7.éªŒè¯æ˜¯å¦ç™»å½•æˆåŠŸ System.out.println(&quot;ç”¨æˆ·ç™»å½•æˆåŠŸ=&quot;+subject.isAuthenticated()); //8.ç™»å½•æˆåŠŸè·å–æ•°æ® //getPrincipal è·å–ç™»å½•æˆåŠŸçš„å®‰å…¨æ•°æ® System.out.println(subject.getPrincipal()); } 4.3 ç”¨æˆ·æˆæƒ æˆæƒï¼Œå³æƒé™éªŒè¯ï¼ŒéªŒè¯æŸä¸ªå·²è®¤è¯çš„ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰æŸä¸ªæƒé™ï¼›å³åˆ¤æ–­ç”¨æˆ·æ˜¯å¦èƒ½åšäº‹æƒ…ï¼Œå¸¸è§çš„å¦‚ï¼šéªŒè¯æŸä¸ªç”¨æˆ·æ˜¯å¦æ‹¥æœ‰æŸä¸ªè§’è‰²ã€‚æˆ–è€…ç»†ç²’åº¦çš„éªŒè¯æŸä¸ªç”¨æˆ·å¯¹æŸä¸ªèµ„æºæ˜¯å¦å…·æœ‰æŸä¸ªæƒé™ åœ¨resourceç›®å½•ä¸‹åˆ›å»ºshiroçš„inié…ç½®æ–‡ä»¶æ„é€ æ¨¡æ‹Ÿæ•°æ®ï¼ˆshiro-prem.iniï¼‰ [users] #æ¨¡æ‹Ÿä»æ•°æ®åº“æŸ¥è¯¢çš„ç”¨æˆ· #æ•°æ®æ ¼å¼ ç”¨æˆ·å=å¯†ç ,è§’è‰²1,è§’è‰²2.. lxy=123456789,role1,role2 xgl=987654321,role2 [roles] #æ¨¡æ‹Ÿä»æ•°æ®åº“æŸ¥è¯¢çš„è§’è‰²å’Œæƒé™åˆ—è¡¨ #æ•°æ®æ ¼å¼ è§’è‰²å=æƒé™1ï¼Œæƒé™2 role1=user:save,user:update role2=user:update,user:delete role3=user:find å®Œæˆç”¨æˆ·æˆæƒ package cn.xgl6.shiro; import org.apache.shiro.SecurityUtils; import org.apache.shiro.authc.UsernamePasswordToken; import org.apache.shiro.config.IniSecurityManagerFactory; import org.apache.shiro.mgt.SecurityManager; import org.apache.shiro.subject.Subject; import org.apache.shiro.util.Factory; import org.junit.Test; public class ShiroTest1 { @Test public void testLogin() throws Exception{ //1.åŠ è½½inié…ç½®æ–‡ä»¶åˆ›å»ºSecurityManager Factory&lt;SecurityManager&gt; factory = new IniSecurityManagerFactory(&quot;classpath:shiro.ini&quot;); //2.è·å–securityManager SecurityManager securityManager = factory.getInstance(); //3.å°†securityManagerç»‘å®šåˆ°å½“å‰è¿è¡Œç¯å¢ƒ SecurityUtils.setSecurityManager(securityManager); //4.åˆ›å»ºä¸»ä½“(æ­¤æ—¶çš„ä¸»ä½“è¿˜ä¸ºç»è¿‡è®¤è¯) Subject subject = SecurityUtils.getSubject(); /** * æ¨¡æ‹Ÿç™»å½•ï¼Œå’Œä¼ ç»Ÿç­‰ä¸åŒçš„æ˜¯éœ€è¦ä½¿ç”¨ä¸»ä½“è¿›è¡Œç™»å½• */ //5.æ„é€ ä¸»ä½“ç™»å½•çš„å‡­è¯ï¼ˆå³ç”¨æˆ·å/å¯†ç ï¼‰ //ç¬¬ä¸€ä¸ªå‚æ•°ï¼šç™»å½•ç”¨æˆ·åï¼Œç¬¬äºŒä¸ªå‚æ•°ï¼šç™»å½•å¯†ç  UsernamePasswordToken upToken = new UsernamePasswordToken(&quot;xgl&quot;,&quot;987654321&quot;); //6.ä¸»ä½“ç™»å½• subject.login(upToken); //7.ç”¨æˆ·è®¤è¯æˆåŠŸä¹‹åæ‰å¯ä»¥å®Œæˆæˆæƒå·¥ä½œ boolean hasPerm = subject.isPermitted(&quot;user:save&quot;); System.out.println(&quot;ç”¨æˆ·æ˜¯å¦å…·æœ‰saveæƒé™=&quot;+hasPerm); } } 4.4 è‡ªå®šä¹‰Realm RealmåŸŸï¼šShiroä»Realmè·å–å®‰å…¨æ•°æ®ï¼ˆå¦‚ç”¨æˆ·ã€è§’è‰²ã€æƒé™ï¼‰ï¼Œå°±æ˜¯è¯´SecurityManagerè¦éªŒè¯ç”¨æˆ·èº«ä»½ï¼Œé‚£ä¹ˆå®ƒéœ€è¦ä»Realmè·å–ç›¸åº”çš„ç”¨æˆ·è¿›è¡Œæ¯”è¾ƒä»¥ç¡®å®šç”¨æˆ·èº«ä»½æ˜¯å¦åˆæ³•ï¼›ä¹Ÿéœ€è¦ä»Realmå¾—åˆ°ç”¨æˆ·ç›¸åº”çš„è§’è‰²/æƒé™è¿›è¡ŒéªŒè¯ç”¨æˆ·æ˜¯å¦èƒ½è¿›è¡Œæ“ä½œï¼›å¯ä»¥æŠŠRealmçœ‹æˆDataSourceï¼Œå³å®‰å…¨æ•°æ®æº è‡ªå®šä¹‰Realm package cn.xgl6.shiro; import org.apache.shiro.authc.*; import org.apache.shiro.authz.AuthorizationInfo; import org.apache.shiro.authz.SimpleAuthorizationInfo; import org.apache.shiro.realm.AuthorizingRealm; import org.apache.shiro.subject.PrincipalCollection; import java.util.ArrayList; import java.util.List; /** * è‡ªå®šä¹‰realmï¼Œéœ€è¦ç»§æ‰¿AuthorizingRealmçˆ¶ç±» * é‡å†™çˆ¶ç±»ä¸­çš„ä¸¤ä¸ªæ–¹æ³• * doGetAuthorizationInfo ï¼šæˆæƒ * doGetAuthenticationInfo ï¼šè®¤è¯ */ public class PermissionRealm extends AuthorizingRealm { @Override public void setName(String name) { super.setName(&quot;permissionRealm&quot;); } /** * æˆæƒï¼šæˆæƒçš„ä¸»è¦ç›®çš„å°±æ˜¯æŸ¥è¯¢æ•°æ®åº“è·å–ç”¨æˆ·çš„æ‰€æœ‰è§’è‰²å’Œæƒé™ä¿¡æ¯ */ protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principalCollection) { // 1.ä»principalsè·å–å·²è®¤è¯ç”¨æˆ·çš„ä¿¡æ¯ String username = (String) principalCollection.getPrimaryPrincipal(); /** * æ­£å¼ç³»ç»Ÿï¼šåº”è¯¥ä»æ•°æ®åº“ä¸­æ ¹æ®ç”¨æˆ·åæˆ–è€…idæŸ¥è¯¢ * è¿™é‡Œä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼Œæ‰‹åŠ¨æ„é€  */ // 2.æ¨¡æ‹Ÿä»æ•°æ®åº“ä¸­æŸ¥è¯¢çš„ç”¨æˆ·æ‰€æœ‰æƒé™ List&lt;String&gt; permissions = new ArrayList&lt;String&gt;(); permissions.add(&quot;user:save&quot;);// ç”¨æˆ·çš„åˆ›å»º permissions.add(&quot;user:update&quot;);// å•†å“æ·»åŠ æƒé™ // 3.æ¨¡æ‹Ÿä»æ•°æ®åº“ä¸­æŸ¥è¯¢çš„ç”¨æˆ·æ‰€æœ‰è§’è‰² List&lt;String&gt; roles = new ArrayList&lt;String&gt;(); roles.add(&quot;role1&quot;); roles.add(&quot;role2&quot;); // 4.æ„é€ æƒé™æ•°æ® SimpleAuthorizationInfo simpleAuthorizationInfo = new SimpleAuthorizationInfo(); // 5.å°†æŸ¥è¯¢çš„æƒé™æ•°æ®ä¿å­˜åˆ°simpleAuthorizationInfo simpleAuthorizationInfo.addStringPermissions(permissions); // 6.å°†æŸ¥è¯¢çš„è§’è‰²æ•°æ®ä¿å­˜åˆ°simpleAuthorizationInfo simpleAuthorizationInfo.addRoles(roles); return simpleAuthorizationInfo; } /** * è®¤è¯ï¼šè®¤è¯çš„ä¸»è¦ç›®çš„ï¼Œæ¯”è¾ƒç”¨æˆ·è¾“å…¥çš„ç”¨æˆ·åå¯†ç æ˜¯å¦å’Œæ•°æ®åº“ä¸­çš„ä¸€è‡´ */ protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken authenticationToken) throws AuthenticationException { //1.è·å–ç™»å½•çš„upToken UsernamePasswordToken upToken = (UsernamePasswordToken)authenticationToken; //2.è·å–è¾“å…¥çš„ç”¨æˆ·åå¯†ç  String username = upToken.getUsername(); String password = new String(upToken.getPassword()); /** * 3.éªŒè¯ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡® * æ­£å¼ç³»ç»Ÿï¼šåº”è¯¥ä»æ•°æ®åº“ä¸­æŸ¥è¯¢ç”¨æˆ·å¹¶æ¯”è¾ƒå¯†ç æ˜¯å¦ä¸€è‡´ * ä¸ºäº†æµ‹è¯•ï¼Œåªè¦è¾“å…¥çš„å¯†ç ä¸º123456åˆ™ç™»å½•æˆåŠŸ */ if(!password.equals(&quot;123456&quot;)) { throw new RuntimeException(&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;);//æŠ›å‡ºå¼‚å¸¸è¡¨ç¤ºè®¤è¯å¤±è´¥ }else{ SimpleAuthenticationInfo info = new SimpleAuthenticationInfo(username, password, this.getName()); return info; } } } é…ç½®shiroçš„inié…ç½®æ–‡ä»¶ï¼ˆshiro-realm.iniï¼‰ [main] #å£°æ˜realm permRealm=cn.xgl6.shiro.PermissionRealm #æ³¨å†Œrealmåˆ°securityManagerä¸­ securityManager.realms=$permRealm éªŒè¯ package cn.xgl6.shiro; import org.apache.shiro.SecurityUtils; import org.apache.shiro.authc.UsernamePasswordToken; import org.apache.shiro.config.IniSecurityManagerFactory; import org.apache.shiro.mgt.SecurityManager; import org.apache.shiro.subject.Subject; import org.apache.shiro.util.Factory; import org.junit.Before; import org.junit.Test; public class ShiroTest2 { private SecurityManager securityManager; @Before public void init() throws Exception{ //1.åŠ è½½inié…ç½®æ–‡ä»¶åˆ›å»ºSecurityManager Factory&lt;SecurityManager&gt; factory = new IniSecurityManagerFactory(&quot;classpath:shiro-realm.ini&quot;); //2.è·å–securityManager SecurityManager securityManager = factory.getInstance(); //13.å°†securityManagerç»‘å®šåˆ°å½“å‰è¿è¡Œç¯å¢ƒ SecurityUtils.setSecurityManager(securityManager); } @Test public void testLogin() throws Exception{ //1.åˆ›å»ºä¸»ä½“(æ­¤æ—¶çš„ä¸»ä½“è¿˜ä¸ºç»è¿‡è®¤è¯) Subject subject = SecurityUtils.getSubject(); //2.æ„é€ ä¸»ä½“ç™»å½•çš„å‡­è¯ï¼ˆå³ç”¨æˆ·å/å¯†ç ï¼‰ UsernamePasswordToken upToken = new UsernamePasswordToken(&quot;lisi&quot;,&quot;123456&quot;); //3.ä¸»ä½“ç™»å½• subject.login(upToken); //ç™»å½•æˆåŠŸéªŒè¯æ˜¯å¦å…·æœ‰role1è§’è‰² //System.out.println(&quot;å½“å‰ç”¨æˆ·å…·æœ‰role1=&quot;+subject.hasRole(&quot;role3&quot;)); //ç™»å½•æˆåŠŸéªŒè¯æ˜¯å¦å…·æœ‰æŸäº›æƒé™ System.out.println(&quot;å½“å‰ç”¨æˆ·å…·æœ‰user:saveæƒé™=&quot;+subject.isPermitted(&quot;user:save&quot;)); } } 4.5 è®¤è¯ä¸æˆæƒçš„æ‰§è¡Œæµç¨‹åˆ†æ ( 1 ) è®¤è¯æµç¨‹ é¦–å…ˆè°ƒç”¨Subject.login(token)è¿›è¡Œç™»å½•ï¼Œå…¶ä¼šè‡ªåŠ¨å§”æ‰˜ç»™Security Managerï¼Œè°ƒç”¨ä¹‹å‰å¿…é¡»é€šè¿‡SecurityUtils. setSecurityManager()è®¾ç½®ï¼› SecurityManagerè´Ÿè´£çœŸæ­£çš„èº«ä»½éªŒè¯é€»è¾‘ï¼›å®ƒä¼šå§”æ‰˜ç»™Authenticatorè¿›è¡Œèº«ä»½éªŒè¯ï¼› Authenticatoræ‰æ˜¯çœŸæ­£çš„èº«ä»½éªŒè¯è€…ï¼ŒShiro APIä¸­æ ¸å¿ƒçš„èº«ä»½è®¤è¯å…¥å£ç‚¹ï¼Œæ­¤å¤„å¯ä»¥è‡ªå®šä¹‰æ’å…¥è‡ªå·±çš„å®ç°ï¼› Authenticatorå¯èƒ½ä¼šå§”æ‰˜ç»™ç›¸åº”çš„AuthenticationStrategyè¿›è¡Œå¤šRealmèº«ä»½éªŒè¯ï¼Œé»˜è®¤ ModularRealmAuthenticatorä¼šè°ƒç”¨AuthenticationStrategyè¿›è¡Œå¤šRealmèº«ä»½éªŒè¯ï¼› Authenticatorä¼šæŠŠç›¸åº”çš„tokenä¼ å…¥Realmï¼Œä»Realmè·å–èº«ä»½éªŒè¯ä¿¡æ¯ï¼Œå¦‚æœæ²¡æœ‰è¿”å›/æŠ›å‡ºå¼‚å¸¸è¡¨ç¤ºèº«ä»½éªŒè¯å¤±è´¥äº†ã€‚æ­¤å¤„å¯ä»¥é…ç½®å¤šä¸ªRealmï¼Œå°†æŒ‰ç…§ç›¸åº”çš„é¡ºåºåŠç­–ç•¥è¿›è¡Œè®¿é—®ã€‚ ( 2 ) æˆæƒæµç¨‹ é¦–å…ˆè°ƒç”¨Subject.isPermitted/hasRoleæ¥å£ï¼Œå…¶ä¼šå§”æ‰˜ç»™SecurityManagerï¼Œè€ŒSecurityManageræ¥ç€ä¼šå§”æ‰˜ç»™Authorizerï¼› Authorizeræ˜¯çœŸæ­£çš„æˆæƒè€…ï¼Œå¦‚æœæˆ‘ä»¬è°ƒç”¨å¦‚isPermitted(â€œuser:viewâ€)ï¼Œå…¶é¦–å…ˆä¼šé€šè¿‡PermissionResolveræŠŠå­—ç¬¦ä¸²è½¬æ¢æˆç›¸åº”çš„Permissionå®ä¾‹ï¼› åœ¨è¿›è¡Œæˆæƒä¹‹å‰ï¼Œå…¶ä¼šè°ƒç”¨ç›¸åº”çš„Realmè·å–Subjectç›¸åº”çš„è§’è‰²/æƒé™ç”¨äºåŒ¹é…ä¼ å…¥çš„è§’è‰²/æƒé™ï¼› Authorizerä¼šåˆ¤æ–­Realmçš„è§’è‰²/æƒé™æ˜¯å¦å’Œä¼ å…¥çš„åŒ¹é…ï¼Œå¦‚æœæœ‰å¤šä¸ªRealmï¼Œä¼šå§”æ‰˜ç»™ ModularRealmAuthorizerè¿›è¡Œå¾ªç¯åˆ¤æ–­ï¼Œå¦‚æœåŒ¹é…å¦‚isPermitted/hasRoleä¼šè¿”å›trueï¼Œå¦åˆ™è¿”å›falseè¡¨ç¤ºæˆæƒå¤±è´¥ã€‚ 5. Shiroçš„é«˜çº§åº”ç”¨ 5.1 Shiroåœ¨Spring Bootå·¥ç¨‹ä¸­çš„åº”ç”¨ åœ¨ä¹‹å‰çš„è®²è§£ä¸­åªæ˜¯å•ç‹¬çš„ä½¿ç”¨shiroï¼Œæ–¹ä¾¿å¤§ä¼™å¯¹shiroæœ‰ä¸€ä¸ªç›´è§‚ä¸”æ¸…æ™°çš„è®¤çŸ¥ï¼Œæˆ‘ä»¬ä»Šå¤©å°±æ¥çœ‹ä¸€ä¸‹shiroåœ¨SpringBootå·¥ç¨‹ä¸­å¦‚ä½•ä½¿ç”¨ä»¥åŠå…¶ä»–ç‰¹æ€§ 5.1.1 æ¡ˆä¾‹è¯´æ˜ ä½¿ç”¨springBootæ„å»ºåº”ç”¨ç¨‹åºï¼Œæ•´åˆshiroæ¡†æ¶å®Œæˆç”¨æˆ·è®¤è¯ä¸æˆæƒã€‚ RBACæ¨¡å‹ 5.1.1.1 æ•°æ®åº“è¡¨ 5.1.1.2 åŸºæœ¬é¡¹ç›®ç»“æ„ ç‚¹æˆ‘æ‰“å¼€ 5.1.2 æ•´åˆShiro 5.1.2.1 Springå’ŒShiroçš„æ•´åˆä¾èµ– &lt;!--shiroå’Œspringæ•´åˆ--&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.shiro&lt;/groupId&gt; &lt;artifactId&gt;shiro-spring&lt;/artifactId&gt; &lt;version&gt;1.3.2&lt;/version&gt; &lt;/dependency&gt; &lt;!--shiroæ ¸å¿ƒåŒ…--&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.shiro&lt;/groupId&gt; &lt;artifactId&gt;shiro-core&lt;/artifactId&gt; &lt;version&gt;1.3.2&lt;/version&gt; &lt;/dependency&gt; &lt;!--shiroä¸redisæ•´åˆ--&gt; &lt;dependency&gt; &lt;groupId&gt;org.crazycake&lt;/groupId&gt; &lt;artifactId&gt;shiro-redis&lt;/artifactId&gt; &lt;version&gt;3.0.0&lt;/version&gt; &lt;/dependency&gt; 5.1.2.2 ä¿®æ”¹ç™»å½•æ–¹æ³• è®¤è¯ï¼šèº«ä»½è®¤è¯/ç™»å½•ï¼ŒéªŒè¯ç”¨æˆ·æ˜¯ä¸æ˜¯æ‹¥æœ‰ç›¸åº”çš„èº«ä»½ã€‚åŸºäºshiroçš„è®¤è¯ï¼Œshiroéœ€è¦é‡‡é›†åˆ°ç”¨æˆ·ç™»å½•æ•°æ®ä½¿ç”¨subjectçš„loginæ–¹æ³•è¿›å…¥realmå®Œæˆè®¤è¯å·¥ä½œã€‚ /** * ä¼ ç»Ÿç™»å½• * å‰ç«¯å‘é€ç™»å½•è¯·æ±‚ =&gt; æ¥å£éƒ¨åˆ†è·å–ç”¨æˆ·åå¯†ç  =&gt; ç¨‹åºå‘˜åœ¨æ¥å£æ‰‹åŠ¨æ§åˆ¶ * shiroç™»å½• * å‰ç«¯å‘é€ç™»å½•è¯·æ±‚ =&gt; æ¥å£è·å–ç”¨æˆ·åå¯†ç  =&gt; é€šè¿‡subject.login() =&gt; realmåŸŸè®¤è¯æ–¹æ³• * @param userName * @param pwd * @return */ @RequestMapping(value = &quot;/login&quot;) public String login(String userName, String pwd){ try { /** * å¯†ç åŠ å¯† * shiroæä¾›çš„md5åŠ å¯† * Md5Hash * å‚æ•°ä¸€:åŠ å¯†çš„å†…å®¹ * å‚æ•°äºŒ:ç›(åŠ å¯†çš„æ··æ·†å­—ç¬¦ä¸²),ä¸€èˆ¬æ˜¯ç”¨æˆ·å * å‚æ•°ä¸‰:åŠ å¯†æ¬¡æ•° */ pwd = new Md5Hash(pwd,userName,3).toString(); //1.æ„é€ ç™»å½•ä»¤ç‰Œ UsernamePasswordToken token = new UsernamePasswordToken(userName,pwd); //2.è·å–subject Subject subject = SecurityUtils.getSubject(); //3.è°ƒç”¨subjectè¿›è¡Œç™»å½• subject.login(token); return &quot;ç™»å½•æˆåŠŸ&quot;; }catch (Exception e){ return &quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;; } } 5.1.2.3 è‡ªå®šä¹‰Realm package cn.xgl6.realm; import cn.xgl6.pojo.Permission; import cn.xgl6.pojo.Role; import cn.xgl6.pojo.User; import cn.xgl6.service.UserService; import org.apache.shiro.authc.*; import org.apache.shiro.authz.AuthorizationInfo; import org.apache.shiro.authz.SimpleAuthorizationInfo; import org.apache.shiro.realm.AuthorizingRealm; import org.apache.shiro.subject.PrincipalCollection; import org.springframework.beans.factory.annotation.Autowired; import java.util.HashSet; import java.util.Set; /** * @author xgl * @create 2019-11-12 18:49 */ public class UserRealm extends AuthorizingRealm { @Autowired private UserService userService; @Override public void setName(String name){ super.setName(&quot;UserRealm&quot;); } /** * æˆæƒ * åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å…·æœ‰ç›¸åº”çš„æƒé™ * å…ˆè®¤è¯,---å®‰å…¨æ•°æ® * å†æˆæƒ -- æ ¹æ®å®‰å…¨æ•°æ®è·å–ç”¨æˆ·æ˜¯å¦å…·æœ‰ç›¸åº”æƒé™ * @param principalCollection * @return */ @Override protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principalCollection) { //1.è·å–å·²è®¤è¯çš„ç”¨æˆ·æ•°æ® User user = (User) principalCollection.getPrimaryPrincipal(); //2.æ ¹æ®ç”¨æˆ·æ•°æ®è·å–ç”¨æˆ·æƒé™ä¿¡æ¯(æ‰€æœ‰è§’è‰²,æ‰€æœ‰æƒé™) SimpleAuthorizationInfo info = new SimpleAuthorizationInfo(); Set&lt;String&gt; roles = new HashSet&lt;&gt;(); Set&lt;String&gt; perms = new HashSet&lt;&gt;(); for (Role role : user.getRoles()) { roles.add(role.getName()); for (Permission perm : role.getPermissions()) { perms.add(perm.getCode()); } } info.setStringPermissions(perms); info.setRoles(roles); return info; } @Override protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken authenticationToken) throws AuthenticationException { //1.è·å–ç™»å½•çš„ç”¨æˆ·åå’Œå¯†ç  UsernamePasswordToken token = (UsernamePasswordToken) authenticationToken; String userName = token.getUsername(); System.out.println(&quot;realmä¸­çš„ç”¨æˆ·å&quot; + userName); String pwd = String.valueOf(token.getPassword()); System.out.println(&quot;realmä¸­çš„å¯†ç &quot; + pwd); //2.æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢æ•°æ®åº“ User user = userService.findByName(userName); //3.åˆ¤æ–­æ˜¯å¦ä¸€è‡´ if (user != null &amp;&amp; user.getPassword().equals(pwd)){ //4.å¦‚æœä¸€è‡´,è¿”å›å®‰å…¨æ•°æ® return new SimpleAuthenticationInfo(user, pwd, getName()); }else { //5.è¿”å›nullæˆ–è€…æŠ›å‡ºå¼‚å¸¸ return null; } } } 5.1.3 Shiroçš„é…ç½® SecurityManager æ˜¯ Shiro æ¶æ„çš„å¿ƒè„ï¼Œç”¨äºåè°ƒå†…éƒ¨çš„å¤šä¸ªç»„ä»¶å®Œæˆå…¨éƒ¨è®¤è¯æˆæƒçš„è¿‡ç¨‹ã€‚ä¾‹å¦‚é€šè¿‡è°ƒç”¨realmå®Œæˆè®¤è¯ä¸ç™»å½•ã€‚ä½¿ç”¨åŸºäºspringbootçš„é…ç½®æ–¹å¼å®ŒæˆSecurityManagerï¼ŒRealmçš„è£…é… package cn.xgl6; import cn.xgl6.realm.UserRealm; import org.apache.shiro.mgt.SecurityManager; import org.apache.shiro.spring.security.interceptor.AuthorizationAttributeSourceAdvisor; import org.apache.shiro.spring.web.ShiroFilterFactoryBean; import org.apache.shiro.web.mgt.DefaultWebSecurityManager; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import java.util.LinkedHashMap; import java.util.Map; /** * @author xgl * @create 2019-11-12 19:50 */ @Configuration public class ShiroConfiguration { //1.åˆ›å»ºrealm @Bean public UserRealm getRealm(){ return new UserRealm(); } //2.åˆ›å»ºå®‰å…¨ç®¡ç†å™¨ @Bean public SecurityManager getSecurityManager(UserRealm realm){ DefaultWebSecurityManager securityManager = new DefaultWebSecurityManager(realm); return securityManager; } //3.é…ç½®shiroè¿‡æ»¤å™¨å·¥å‚ /** * åœ¨webç¨‹åºä¸­,shiroè¿›è¡Œæƒé™æ§åˆ¶å…¨éƒ½æ˜¯é€šè¿‡ä¸€ç»„è¿‡æ»¤å™¨é›†åˆè¿›è¡Œæ§åˆ¶çš„ * * * @param securityManager * @return */ @Bean public ShiroFilterFactoryBean getShiroFilter(SecurityManager securityManager){ //1.åˆ›å»ºè¿‡æ»¤å™¨å·¥å‚ ShiroFilterFactoryBean filterFactory = new ShiroFilterFactoryBean(); //2.è®¾ç½®å®‰å…¨ç®¡ç†å™¨ filterFactory.setSecurityManager(securityManager); //3.é€šç”¨é…ç½®(è·³è½¬çš„ç™»å½•é¡µé¢,æœªæˆæƒè·³è½¬çš„é¡µé¢) //3.1 æŒ‡å®šç™»å½•é¡µé¢ filterFactory.setLoginUrl(&quot;/autherror?code=1&quot;); //3.2æŒ‡å®šæœªæˆæƒé¡µé¢ filterFactory.setUnauthorizedUrl(&quot;/autherror?code=2&quot;); //4.è®¾ç½®è¿‡æ»¤å™¨é›†åˆ /** * é€šè¿‡æœ‰é¡ºåºçš„ map é›†åˆè¿›è¡Œæ§åˆ¶ * key = æ‹¦æˆªçš„URLåœ°å€ * value = è¿‡æ»¤å™¨ç±»å‹ */ Map&lt;String,String&gt; filterMap = new LinkedHashMap&lt;&gt;(); //åŒ¿åè®¿é—® //filterMap.put(&quot;/user/home&quot;,&quot;anon&quot;); filterMap.put(&quot;/user/home&quot;,&quot;perms[user-home]&quot;); //å¿…é¡»è®¤è¯åæ‰èƒ½è®¿é—® filterMap.put(&quot;/user/**&quot;,&quot;authc&quot;); filterFactory.setFilterChainDefinitionMap(filterMap); //5.è¿”å›è¿‡æ»¤å™¨å·¥å‚ return filterFactory; } //4.å¼€å¯å¯¹shiroæ³¨è§£çš„æ”¯æŒ @Bean public AuthorizationAttributeSourceAdvisor authorizationAttributeSourceAdvisor(SecurityManager securityManager) { AuthorizationAttributeSourceAdvisor advisor = new AuthorizationAttributeSourceAdvisor(); advisor.setSecurityManager(securityManager); return advisor; } /** * Shiroç”Ÿå‘½å‘¨æœŸå¤„ç†å™¨ */ @Bean(name = &quot;lifecycleBeanPostProcessor&quot;) public static LifecycleBeanPostProcessor getLifecycleBeanPostProcessor() { return new LifecycleBeanPostProcessor(); } /** * å¼€å¯Shiroçš„æ³¨è§£(å¦‚@RequiresRoles,@RequiresPermissions),éœ€å€ŸåŠ©SpringAOPæ‰«æä½¿ç”¨Shiroæ³¨è§£çš„ç±»,å¹¶åœ¨å¿…è¦æ—¶è¿›è¡Œå®‰å…¨é€»è¾‘éªŒè¯ */ @Bean @DependsOn(&quot;lifecycleBeanPostProcessor&quot;) public DefaultAdvisorAutoProxyCreator defaultAdvisorAutoProxyCreator() { DefaultAdvisorAutoProxyCreator creator = new DefaultAdvisorAutoProxyCreator(); creator.setProxyTargetClass(true); return creator; } } 5.1.4 Shiroä¸­çš„è¿‡æ»¤å™¨ è§£é‡Š anon æ— å‚,å¼€æ”¾æƒé™,å¯ä»¥ç†è§£ä¸ºåŒ¿åç”¨æˆ·æˆ–æ¸¸å®¢ authc æ— å‚,éœ€è¦è®¤è¯ logout æ— å‚,æ³¨é”€,æ‰§è¡Œåä¼šè·³è½¬åˆ°shiroFilterFactoryBean.setLoginUrl(); è®¾ç½®çš„url authcBasic æ— å‚ï¼Œè¡¨ç¤º httpBasic è®¤è¯ user æ— å‚ï¼Œè¡¨ç¤ºå¿…é¡»å­˜åœ¨ç”¨æˆ·ï¼Œå½“ç™»å…¥æ“ä½œæ—¶ä¸åšæ£€æŸ¥ ssl æ— å‚ï¼Œè¡¨ç¤ºå®‰å…¨çš„URLè¯·æ±‚ï¼Œåè®®ä¸º https perms[user] å‚æ•°å¯å†™å¤šä¸ªï¼Œè¡¨ç¤ºéœ€è¦æŸä¸ªæˆ–æŸäº›æƒé™æ‰èƒ½é€šè¿‡ï¼Œå¤šä¸ªå‚æ•°æ—¶å†™ perms[â€œuser,adminâ€]ï¼Œå½“æœ‰å¤šä¸ªå‚æ•°æ—¶å¿…é¡»æ¯ä¸ªå‚æ•°éƒ½é€šè¿‡æ‰ç®—é€šè¿‡ roles[admin] å‚æ•°å¯å†™å¤šä¸ªï¼Œè¡¨ç¤ºæ˜¯æŸä¸ªæˆ–æŸäº›è§’è‰²æ‰èƒ½é€šè¿‡ï¼Œå¤šä¸ªå‚æ•°æ—¶å†™ roles[â€œadminï¼Œuserâ€],å½“æœ‰å¤šä¸ªå‚æ•°æ—¶å¿…é¡»æ¯ä¸ªå‚æ•°éƒ½é€šè¿‡æ‰ç®—é€šè¿‡ rest[user] æ ¹æ®è¯·æ±‚çš„æ–¹æ³•ï¼Œç›¸å½“äº perms[user:method]ï¼Œå…¶ä¸­ method ä¸º postï¼Œgetï¼Œdelete ç­‰ port[8081] å½“è¯·æ±‚çš„URLç«¯å£ä¸æ˜¯8081æ—¶ï¼Œè·³è½¬åˆ°å½“å‰è®¿é—®ä¸»æœºHOSTçš„8081ç«¯å£ 5.1.5 æˆæƒ æˆæƒï¼šå³æƒé™éªŒè¯ï¼ŒéªŒè¯æŸä¸ªå·²è®¤è¯çš„ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰æŸä¸ªæƒé™ï¼›å³åˆ¤æ–­ç”¨æˆ·æ˜¯å¦èƒ½åšäº‹æƒ… shiroæ”¯æŒåŸºäºè¿‡æ»¤å™¨çš„æˆæƒæ–¹å¼ä¹Ÿæ”¯æŒæ³¨è§£çš„æˆæƒæ–¹å¼ 5.1.5.1 åŸºäºé…ç½®çš„æˆæƒ åœ¨shiroä¸­å¯ä»¥ä½¿ç”¨è¿‡æ»¤å™¨çš„æ–¹å¼é…ç½®ç›®æ ‡åœ°å€çš„è¯·æ±‚æƒé™ //é…ç½®è¯·æ±‚è¿æ¥è¿‡æ»¤å™¨é…ç½® //åŒ¿åè®¿é—®ï¼ˆæ‰€æœ‰äººå‘˜å¯ä»¥ä½¿ç”¨ï¼‰ filterMap.put(&quot;/user/home&quot;, &quot;anon&quot;); //å…·æœ‰æŒ‡å®šæƒé™è®¿é—® filterMap.put(&quot;/user/find&quot;, &quot;perms[user-find]&quot;); //è®¤è¯ä¹‹åè®¿é—®ï¼ˆç™»å½•ä¹‹åå¯ä»¥è®¿é—®ï¼‰ filterMap.put(&quot;/user/**&quot;, &quot;authc&quot;); //å…·æœ‰æŒ‡å®šè§’è‰²å¯ä»¥è®¿é—® filterMap.put(&quot;/user/**&quot;, &quot;roles[ç³»ç»Ÿç®¡ç†å‘˜]&quot;); åŸºäºé…ç½®çš„æ–¹å¼è¿›è¡Œæˆæƒï¼Œä¸€æ—¦æ“ä½œç”¨æˆ·ä¸å…·å¤‡æ“ä½œæƒé™ï¼Œç›®æ ‡åœ°å€ä¸ä¼šè¢«æ‰§è¡Œã€‚ä¼šè·³è½¬åˆ°æŒ‡å®šçš„urlè¿æ¥åœ°å€ã€‚ 5.1.5.2 åŸºäºæ³¨è§£çš„æˆæƒ ( 1 ) RequiresPermissions é…ç½®åˆ°æ–¹æ³•ä¸Š,è¡¨ç¤ºæ‰§è¡Œæ­¤æ–¹æ³•å¿…é¡»å…·æœ‰æŒ‡å®šçš„æƒé™ //æŸ¥è¯¢ @RequiresPermissions(value = &quot;user-find&quot;) public String find() { return &quot;æŸ¥è¯¢ç”¨æˆ·æˆåŠŸ&quot;; } ( 2 ) RequiresRoles é…ç½®åˆ°æ–¹æ³•ä¸Šï¼Œè¡¨æ˜æ‰§è¡Œæ­¤æ–¹æ³•å¿…é¡»å…·æœ‰æŒ‡å®šçš„è§’è‰² //æŸ¥è¯¢ @RequiresRoles(value = &quot;ç³»ç»Ÿç®¡ç†å‘˜&quot;) public String find() { return &quot;æŸ¥è¯¢ç”¨æˆ·æˆåŠŸ&quot;; } åŸºäºæ³¨è§£çš„é…ç½®æ–¹å¼è¿›è¡Œæˆæƒï¼Œä¸€æ—¦æ“ä½œç”¨æˆ·ä¸å…·å¤‡æ“ä½œæƒé™ï¼Œç›®æ ‡æ–¹æ³•ä¸ä¼šè¢«æ‰§è¡Œï¼Œè€Œä¸”ä¼šæŠ›å‡ºAuthorizationException å¼‚å¸¸ã€‚æ‰€ä»¥éœ€è¦åšå¥½ç»Ÿä¸€å¼‚å¸¸å¤„ç†å®Œæˆæœªæˆæƒå¤„ç† 5.2 Shiroä¸­çš„ä¼šè¯ç®¡ç† åœ¨Shiroé‡Œæ‰€æœ‰ç”¨æˆ·çš„ä¼šè¯ä¿¡æ¯éƒ½ä¼šç”±Shiroæ¥è¿›è¡Œæ§åˆ¶,Shiroæä¾›çš„ä¼šè¯å¯ä»¥ç”¨äºJavaSE/JavaEEç¯å¢ƒ,ä¸ä¾èµ–ä»»ä½•åº•å±‚å®¹å™¨,å¯ä»¥ç‹¬ç«‹ä½¿ç”¨,æ˜¯å®Œæ•´çš„ä¼šè¯æ¨¡å—. é€šè¿‡Shiroçš„ä¼šè¯ç®¡ç†å™¨,(SecurityManager) è¿›è¡Œç»Ÿä¸€çš„ä¼šè¯ç®¡ç† 5.2.1 ä»€ä¹ˆæ˜¯Shiroçš„ä¼šè¯ç®¡ç† SessionManager(ä¼šè¯ç®¡ç†å™¨) : ç®¡ç†æ‰€æœ‰çš„Subjectçš„sessionåŒ…æ‹¬åˆ›å»º,ç»´æŠ¤,åˆ é™¤,å¤±æ•ˆ,éªŒè¯ç­‰å·¥ä½œ. SessionManageræ˜¯é¡¶å±‚ç»„ä»¶,ç”±SecurityManagerç®¡ç†. Shiroæä¾›äº†ä¸‰ä¸ªé»˜è®¤å®ç° : DefaultSessionManager : ç”¨äºJavaSEç¯å¢ƒ ServletContainerSessionManager : ç”¨äºWebç¯å¢ƒ,ç›´æ¥ä½¿ç”¨Servletå®¹å™¨çš„ä¼šè¯. DefaultWebSessionManager : ç”¨äºWebç¯å¢ƒ,è‡ªå·±ç»´æŠ¤ä¼šè¯,(è‡ªå·±ç»´æŠ¤ç€ä¼šè¯,ç›´æ¥åºŸå¼ƒäº†Servletå®¹å™¨çš„ä¼šè¯ç®¡ç†). åœ¨webç¨‹åºä¸­,é€šè¿‡Shiroçš„Subject.login()æ–¹æ³•ç™»å½•æˆåŠŸä»¥å,ç”¨æˆ·çš„è®¤è¯ä¿¡æ¯å®é™…ä¸Šæ˜¯ä¿å­˜åœ¨HttpSessionä¸­çš„. é€šè¿‡å¦‚ä¸‹ä»£ç éªŒè¯ : //ç™»å½•æˆåŠŸåï¼Œæ‰“å°æ‰€æœ‰sessionå†…å®¹ @RequestMapping(value=&quot;/show&quot;) public String show(HttpSession session) { // è·å–sessionä¸­æ‰€æœ‰çš„é”®å€¼ Enumeration&lt;?&gt; enumeration = session.getAttributeNames(); // éå†enumerationä¸­çš„ while (enumeration.hasMoreElements()) { // è·å–sessioné”®å€¼ String name = enumeration.nextElement().toString(); // æ ¹æ®é”®å€¼å–sessionä¸­çš„å€¼ Object value = session.getAttribute(name); // æ‰“å°ç»“æœ System.out.println(&quot;&lt;B&gt;&quot; + name + &quot;&lt;/B&gt;=&quot; + value + &quot;&lt;br&gt;/n&quot;); } return &quot;æŸ¥çœ‹sessionæˆåŠŸ&quot;; } 5.2.2 åº”ç”¨åœºæ™¯åˆ†æ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿæˆ–è€…å¾®æœåŠ¡æ¶æ„ä¸‹ï¼Œéƒ½æ˜¯é€šè¿‡ç»Ÿä¸€çš„è®¤è¯ä¸­å¿ƒè¿›è¡Œç”¨æˆ·è®¤è¯ã€‚å¦‚æœä½¿ç”¨é»˜è®¤ä¼šè¯ç®¡ç†ï¼Œç”¨æˆ·ä¿¡æ¯åªä¼šä¿å­˜åˆ°ä¸€å°æœåŠ¡å™¨ä¸Šã€‚é‚£ä¹ˆå…¶ä»–æœåŠ¡å°±éœ€è¦è¿›è¡Œä¼šè¯çš„åŒæ­¥ã€‚ ä¼šè¯ç®¡ç†å™¨å¯ä»¥æŒ‡å®šsessionIdçš„ç”Ÿæˆä»¥åŠè·å–æ–¹å¼ã€‚ é€šè¿‡sessionDaoå®Œæˆæ¨¡æ‹Ÿsessionå­˜å…¥ï¼Œå–å‡ºç­‰æ“ä½œ 5.2.3 Shiroç»“åˆRedisçš„ç»Ÿä¸€ä¼šè¯ç®¡ç† 5.2.3.1 æ­¥éª¤åˆ†æ 5.2.3.2 æ„å»ºç¯å¢ƒ ( 1 ) ä½¿ç”¨å¼€æºç»„ä»¶Shiro-Rediså¯ä»¥æ–¹ä¾¿çš„æ„å»ºShiroä¸Redisçš„æ•´åˆå·¥ç¨‹ &lt;dependency&gt; &lt;groupId&gt;org.crazycake&lt;/groupId&gt; &lt;artifactId&gt;shiro-redis&lt;/artifactId&gt; &lt;version&gt;3.0.0&lt;/version&gt; &lt;/dependency&gt; ( 2 ) åœ¨Spring Booté…ç½®æ–‡ä»¶ä¸­æ·»åŠ Redisçš„é…ç½® redis: host: 127.0.0.1 port: 6379 5.2.3.3 è‡ªå®šä¹‰Shiroä¼šè¯ç®¡ç†å™¨ /** * è‡ªå®šä¹‰çš„sessionManager */ public class CustomSessionManager extends DefaultWebSessionManager { /** * å¤´ä¿¡æ¯ä¸­å…·æœ‰sessionid * è¯·æ±‚å¤´ï¼šAuthorizationï¼š sessionid * * æŒ‡å®šsessionIdçš„è·å–æ–¹å¼ */ protected Serializable getSessionId(ServletRequest request, ServletResponse response) { //è·å–è¯·æ±‚å¤´Authorizationä¸­çš„æ•°æ® String id = WebUtils.toHttp(request).getHeader(&quot;Authorization&quot;); if(StringUtils.isEmpty(id)) { //å¦‚æœæ²¡æœ‰æºå¸¦ï¼Œç”Ÿæˆæ–°çš„sessionId return super.getSessionId(request,response); }else{ //è¿”å›sessionIdï¼› request.setAttribute(ShiroHttpServletRequest.REFERENCED_SESSION_ID_SOURCE, &quot;header&quot;); request.setAttribute(ShiroHttpServletRequest.REFERENCED_SESSION_ID, id); request.setAttribute(ShiroHttpServletRequest.REFERENCED_SESSION_ID_IS_VALID, Boolean.TRUE); return id; } } } 5.2.3.4 é…ç½®ShiroåŸºäºRedisçš„ä¼šè¯ç®¡ç† åœ¨Shiroé…ç½®ç±» cn.xgl6.ShiroConfiguration é…ç½® é…ç½®Shiroçš„RedisManager , é€šè¿‡shiro-redisåŒ…æä¾›çš„RedisManagerç»Ÿä¸€å¯¹Redisæ“ä½œ @Value(&quot;${spring.redis.host}&quot;) private String host; @Value(&quot;${spring.redis.port}&quot;) private int port; //é…ç½®shiro redisManager public RedisManager redisManager() { RedisManager redisManager = new RedisManager(); redisManager.setHost(host); redisManager.setPort(port); return redisManager; } Shiroå†…éƒ¨æœ‰è‡ªå·±çš„æœ¬åœ°ç¼“å­˜æœºåˆ¶,ä¸ºäº†æ›´åŠ ç»Ÿä¸€æ–¹ä¾¿ç®¡ç†,å…¨éƒ¨æ›¿æ¢æˆRediså®ç° //é…ç½®Shiroçš„ç¼“å­˜ç®¡ç†å™¨ //ä½¿ç”¨rediså®ç° public RedisCacheManager cacheManager() { RedisCacheManager redisCacheManager = new RedisCacheManager(); redisCacheManager.setRedisManager(redisManager()); return redisCacheManager; } é…ç½®SessionDao,ä½¿ç”¨shiro-redisåŒ…æä¾›çš„SessionDao /** * RedisSessionDAO shiro sessionDaoå±‚çš„å®ç° é€šè¿‡redis * ä½¿ç”¨çš„æ˜¯shiro-rediså¼€æºæ’ä»¶ */ public RedisSessionDAO redisSessionDAO() { RedisSessionDAO redisSessionDAO = new RedisSessionDAO(); redisSessionDAO.setRedisManager(redisManager()); return redisSessionDAO; } é…ç½®ä¼šè¯ç®¡ç†å™¨,æŒ‡å®šSessionDaoçš„ä¾èµ–å…³ç³» /** * 3.ä¼šè¯ç®¡ç†å™¨ */ public DefaultWebSessionManager sessionManager() { CustomSessionManager sessionManager = new CustomSessionManager(); sessionManager.setSessionDAO(redisSessionDAO()); return sessionManager; } ç»Ÿä¸€äº¤ç»™SecurityManagerç®¡ç† //é…ç½®å®‰å…¨ç®¡ç†å™¨ @Bean public SecurityManager securityManager(CustomRealm realm) { //ä½¿ç”¨é»˜è®¤çš„å®‰å…¨ç®¡ç†å™¨ DefaultWebSecurityManager securityManager = new DefaultWebSecurityManager(realm); // è‡ªå®šä¹‰sessionç®¡ç† ä½¿ç”¨redis securityManager.setSessionManager(sessionManager()); // è‡ªå®šä¹‰ç¼“å­˜å®ç° ä½¿ç”¨redis securityManager.setCacheManager(cacheManager()); //å°†è‡ªå®šä¹‰çš„realmäº¤ç»™å®‰å…¨ç®¡ç†å™¨ç»Ÿä¸€è°ƒåº¦ç®¡ç† securityManager.setRealm(realm); return securityManager; } ","link":"https://xgl6.github.io/post/shiro/"},{"title":"Hello Gridea","content":"ğŸ‘ æ¬¢è¿ä½¿ç”¨ Gridea ï¼ âœï¸ Gridea ä¸€ä¸ªé™ æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ... Github Gridea ä¸»é¡µ ç¤ºä¾‹ç½‘ç«™ ç‰¹æ€§ğŸ‘‡ ğŸ“ ä½ å¯ä»¥ä½¿ç”¨æœ€é…·çš„ Markdown è¯­æ³•ï¼Œè¿›è¡Œå¿«é€Ÿåˆ›ä½œ ğŸŒ‰ ä½ å¯ä»¥ç»™æ–‡ç« é…ä¸Šç²¾ç¾çš„å°é¢å›¾å’Œåœ¨æ–‡ç« ä»»æ„ä½ç½®æ’å…¥å›¾ç‰‡ ğŸ·ï¸ ä½ å¯ä»¥å¯¹æ–‡ç« è¿›è¡Œæ ‡ç­¾åˆ†ç»„ ğŸ“‹ ä½ å¯ä»¥è‡ªå®šä¹‰èœå•ï¼Œç”šè‡³å¯ä»¥åˆ›å»ºå¤–éƒ¨é“¾æ¥èœå• ğŸ’» ä½ å¯ä»¥åœ¨ Windowsï¼ŒMacOS æˆ– Linux è®¾å¤‡ä¸Šä½¿ç”¨æ­¤å®¢æˆ·ç«¯ ğŸŒ ä½ å¯ä»¥ä½¿ç”¨ ğ–¦ğ—‚ğ—ğ—ğ—ğ–» ğ–¯ğ–ºğ—€ğ–¾ğ—Œ æˆ– Coding Pages å‘ä¸–ç•Œå±•ç¤ºï¼Œæœªæ¥å°†æ”¯æŒæ›´å¤šå¹³å° ğŸ’¬ ä½ å¯ä»¥è¿›è¡Œç®€å•çš„é…ç½®ï¼Œæ¥å…¥ Gitalk æˆ– DisqusJS è¯„è®ºç³»ç»Ÿ ğŸ‡¬ğŸ‡§ ä½ å¯ä»¥ä½¿ç”¨ä¸­æ–‡ç®€ä½“æˆ–è‹±è¯­ ğŸŒ ä½ å¯ä»¥ä»»æ„ä½¿ç”¨åº”ç”¨å†…é»˜è®¤ä¸»é¢˜æˆ–ä»»æ„ç¬¬ä¸‰æ–¹ä¸»é¢˜ï¼Œå¼ºå¤§çš„ä¸»é¢˜è‡ªå®šä¹‰èƒ½åŠ› ğŸ–¥ ä½ å¯ä»¥è‡ªå®šä¹‰æºæ–‡ä»¶å¤¹ï¼Œåˆ©ç”¨ OneDriveã€ç™¾åº¦ç½‘ç›˜ã€iCloudã€Dropbox ç­‰è¿›è¡Œå¤šè®¾å¤‡åŒæ­¥ ğŸŒ± å½“ç„¶ Gridea è¿˜å¾ˆå¹´è½»ï¼Œæœ‰å¾ˆå¤šä¸è¶³ï¼Œä½†è¯·ç›¸ä¿¡ï¼Œå®ƒä¼šä¸åœå‘å‰ ğŸƒ æœªæ¥ï¼Œå®ƒä¸€å®šä¼šæˆä¸ºä½ ç¦»ä¸å¼€çš„ä¼™ä¼´ å°½æƒ…å‘æŒ¥ä½ çš„æ‰åå§ï¼ å•¦å•¦å•¦ ğŸ˜˜ Enjoy~ ","link":"https://xgl6.github.io/post/hello-gridea/"}]}